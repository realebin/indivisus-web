<div class="debug-multiselect">
  
  <!-- Toggle button with detailed logging -->
  <div class="toggle-btn" 
       [class.invalid]="isInvalid"
       [class.disabled]="disabled" 
       (click)="toggleDropdown($event)">
    <div class="selected-text">
      <span *ngIf="!hasSelectedOptions()">{{ placeholder }}</span>
      <span *ngIf="hasSelectedOptions()">
        {{ getSelectedCount() }} {{ getSelectedCount() === 1 ? 'item' : 'items' }} selected
      </span>
    </div>
    <div class="toggle-icon">
      <i class="bi" [ngClass]="isOpen ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
    </div>
  </div>

  <!-- Simple dropdown with extensive logging -->
  <div class="dropdown-area" 
       *ngIf="isOpen"
       (click)="$event.stopPropagation()"
       (mousedown)="$event.stopPropagation()">

    <!-- Search -->
    <div class="search-area" *ngIf="allowSearch">
      <input type="text" 
             class="search-box" 
             placeholder="Search..."
             [formControl]="searchControl" 
             (click)="$event.stopPropagation()"
             autocomplete="off">
      <button *ngIf="searchControl.value" 
              class="clear-btn" 
              (click)="searchControl.setValue(''); $event.stopPropagation()">
        Ã—
      </button>
    </div>

    <!-- Select All -->
    <div class="select-all-area">
      <label class="checkbox-label" 
             (click)="toggleSelectAll($event)">
        <input type="checkbox" 
               [checked]="selectAllState === 'checked'"
               [indeterminate]="selectAllState === 'indeterminate'"
               (click)="$event.stopPropagation()"
               readonly>
        <span>Select All</span>
      </label>
    </div>

    <!-- Options -->
    <div class="options-area">
      <div *ngIf="filteredOptions.length === 0" class="no-options">
        No options
      </div>
      
      <div *ngFor="let option of filteredOptions; let i = index" 
           class="option-row">
        <label class="checkbox-label" 
               [class.disabled]="option.disabled"
               (click)="selectOption(option, $event)">
          <input type="checkbox" 
                 [checked]="option.selected" 
                 [disabled]="option.disabled"
                 (click)="$event.stopPropagation()"
                 readonly>
          <span>{{ option.label }}</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Error message -->
  <div *ngIf="isInvalid" class="error-msg">
    {{ invalidMessage }}
  </div>
</div>

<!-- Add this to see when the component itself gets clicked -->
<div *ngIf="isOpen" class="debug-info" style="background: yellow; padding: 4px; font-size: 10px;">
  Dropdown is OPEN - clicking options should keep it open
</div>