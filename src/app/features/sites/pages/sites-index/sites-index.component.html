<div class="container-fluid px-4 py-4">
  <div class="row mb-4">
    <div class="col-md-6">
      <h2 class="fw-bold text-primary mb-1">Site Management</h2>
      <p class="text-muted">Manage warehouse and storage locations</p>
    </div>
    <div class="col-md-6 d-flex justify-content-md-end align-items-center mt-3 mt-md-0">
      <button class="btn btn-primary me-2" (click)="openCreateSiteModal()">
        <i class="bi bi-plus-circle me-2"></i>Add New Site
      </button>
      <button class="btn btn-outline-secondary" (click)="toggleFilterPanel()">
        <i class="bi bi-funnel me-2"></i>Filter
      </button>
    </div>
  </div>

  <!-- Filter Panel -->
  <app-filter-panel
    [title]="'Filter Sites'"
    [isVisible]="showFilterPanel"
    [sortOptions]="sortOptions"
    [searchControl]="searchFilter"
    [sortField]="sortField"
    [sortDirection]="sortDirection"
    (togglePanel)="toggleFilterPanel()"
    (sortChange)="onSortChange($event)"
    (resetFilters)="resetFilters()"
    (doneFiltering)="toggleFilterPanel()"
  ></app-filter-panel>

  <!-- Alert for error messages -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ errorMessage }}
    <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
  </div>

  <!-- Loading state -->
  <app-loader *ngIf="isLoading" type="loading-relative"></app-loader>

  <!-- Responsive Data Table -->
  <div *ngIf="!isLoading" class="card shadow-sm border-0 mb-4">
    <div class="card-body p-0">
      <app-responsive-data-table
        [data]="filteredSites"
        [columnDefs]="columnDefs"
        [cardConfigs]="cardConfigs"
        [type]="'SITE'"
        [sortOptions]="sortOptions"
        [title]="'Site Management'"
        (editItem)="openEditSiteModal($event)"
        (deleteItem)="deleteSite($event)"
        (viewItem)="navigateToDetail($event.siteId)"
      ></app-responsive-data-table>
    </div>
  </div>

  <!-- Site Modal Template -->
  <ng-template #createSiteModal>
    <app-modal
      [title]="isEditMode ? 'Edit Site' : 'Create New Site'"
      [confirmButtonText]="'Save'"
      [isFormValid]="isSiteFormValid"
      [isLoading]="isLoading"
      (confirm)="submitSiteForm()">
      <app-site-create-form
        [data]="siteRequest"
        [isEditMode]="isEditMode"
        [errorMessage]="errorMessage"
        (dataChange)="onSiteFormDataChange($event)"
        (formValidityChange)="onSiteFormValidityChange($event)">
      </app-site-create-form>
    </app-modal>
  </ng-template>
</div>
