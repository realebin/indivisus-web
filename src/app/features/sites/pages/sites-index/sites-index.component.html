<div class="container px-4 py-4">
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <div>
        <h2 class="fw-bold text-primary mb-1">Site Management</h2>
        <p class="text-muted mb-0">Manage warehouse and storage locations</p>
      </div>
      <button class="btn btn-primary" (click)="openCreateSiteModal()">
        <i class="bi bi-plus-circle me-2"></i>Add New Site
      </button>
    </div>
  </div>

  <!-- Alert for error messages -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ errorMessage }}
    <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
  </div>

  <!-- Loading state -->
  <app-loader *ngIf="isLoading" type="loading-relative"></app-loader>

  <!-- Site cards list -->
  <div *ngIf="!isLoading && sites.length > 0" class="row">
    <div *ngFor="let site of sites" class="col-12 col-md-6 col-lg-4 mb-4">
      <div class="card h-100 shadow-sm border-0 hover-shadow">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h5 class="card-title text-primary fw-bold mb-0">{{ site.siteName }}</h5>
            <app-action-buttons
              [item]="site"
              [actions]="[
                { type: 'view', icon: 'bi-eye', buttonClass: 'btn-outline-primary' },
                { type: 'edit', icon: 'bi-pencil', buttonClass: 'btn-outline-secondary' },
                { type: 'delete', icon: 'bi-trash', buttonClass: 'btn-outline-danger' }
              ]"
              [showLabels]="false"
              [buttonSize]="'sm'"
              (actionClick)="handleSiteAction($event)">
            </app-action-buttons>
          </div>

          <div class="mb-3">
            <p class="text-muted mb-2">
              <i class="bi bi-geo-alt me-2"></i>{{ site.address || 'No address specified' }}
            </p>
            <p class="text-muted mb-0">
              <i class="bi bi-person me-2"></i>PIC: {{ site.picFullName }}
            </p>
          </div>

          <!-- Stock Overview -->
          <div *ngIf="site.packageOverview?.length || site.sizeOverview?.length" class="mt-3">
            <h6 class="text-secondary mb-2"><i class="bi bi-box-seam me-2"></i>Stock Overview</h6>

            <div class="row g-2 mb-2">
              <ng-container *ngFor="let pkg of site.packageOverview">
                <div *ngIf="pkg.totalPackages" class="col-6">
                  <div class="p-2 bg-light rounded">
                    <small class="text-muted d-block">{{ pkg.type }}</small>
                    <span class="fw-bold">{{ pkg.totalPackages }} packages</span>
                  </div>
                </div>
              </ng-container>
            </div>

            <div class="row g-2">
              <ng-container *ngFor="let size of site.sizeOverview">
                <div *ngIf="size.totalSize" class="col-6">
                  <div class="p-2 bg-light rounded">
                    <small class="text-muted d-block">{{ size.type }}</small>
                    <span class="fw-bold">{{ size.totalSize }} units</span>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>

          <!-- View Details Button -->
          <div class="mt-3">
            <app-action-buttons
              [item]="site"
              [actions]="[
                { type: 'view', icon: 'bi-eye', label: 'View Site Details', buttonClass: 'btn-outline-primary' }
              ]"
              [justifyContent]="'center'"
              (actionClick)="handleSiteAction($event)">
            </app-action-buttons>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading && sites.length === 0" class="text-center py-5">
    <i class="bi bi-building text-muted" style="font-size: 3rem;"></i>
    <h4 class="mt-3 text-muted">No Sites Found</h4>
    <p class="text-muted">Get started by adding your first site</p>
    <button class="btn btn-primary mt-2" (click)="openCreateSiteModal()">
      <i class="bi bi-plus-circle me-2"></i>Add New Site
    </button>
  </div>

  <!-- Site Modal Template -->
  <ng-template #createSiteModal>
    <app-modal
      [title]="isEditMode ? 'Edit Site' : 'Create New Site'"
      [confirmButtonText]="'Save'"
      [isFormValid]="isSiteFormValid"
      [isLoading]="isLoading"
      (confirm)="submitSiteForm()">
      <app-site-create-form
        [data]="siteRequest"
        [isEditMode]="isEditMode"
        [errorMessage]="errorMessage"
        (dataChange)="onSiteFormDataChange($event)"
        (formValidityChange)="onSiteFormValidityChange($event)">
      </app-site-create-form>
    </app-modal>
  </ng-template>
</div>
